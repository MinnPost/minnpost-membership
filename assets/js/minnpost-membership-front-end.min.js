!function(){"use strict";function e(e,t){this.data={},void 0!==e&&(this.data=e),this.settings={},void 0!==t&&(this.settings=t),this.previousAmount="",void 0!==this.data.current_user&&void 0!==this.data.current_user.previous_amount&&(this.previousAmount=this.data.current_user.previous_amount)}var t,l;t=window,e.prototype={checkLevel(n,e,i){let s=parseInt(n)*parseInt(e);if(void 0!==this.previousAmount&&""!==this.previousAmount){let e=parseInt(this.previousAmount.prior_year_contributions,10);n=parseInt(this.previousAmount.coming_year_contributions,10);let t=parseInt(this.previousAmount.annual_recurring_amount,10);"one-time"===i?e+=s:t+=s,s=Math.max(e,n,t)}return this.getLevel(s)},getLevel(e){const t={yearlyAmount:e};return 0<e&&e<60?(t.name="Bronze",t.number=1):59<e&&e<120?(t.name="Silver",t.number=2):119<e&&e<240?(t.name="Gold",t.number=3):239<e&&(t.name="Platinum",t.number=4),t}},t.MinnPostMembership=new e(t.minnpost_membership_data,t.minnpost_membership_settings);{var o=jQuery,r=(window,document),a=MinnPostMembership;const u="minnpostAmountSelect",h={frequencySelector:'.m-frequency-select input[type="radio"]',amountGroup:".m-frequency-group",amountSelector:'.m-amount-select input[type="radio"]',amountLabels:".m-amount-select label",amountValue:"strong",amountDescription:".a-amount-description",amountField:".a-amount-field #amount",customAmountFrequency:"#amount-item .a-frequency-text-label",levelViewer:".a-show-level",levelName:".a-level",userCurrentLevel:".a-current-level",declineBenefits:'.m-decline-benefits-select input[type="radio"]',giftSelectionGroup:".m-membership-gift-selector",giftLevel:".m-gift-level",giftSelector:'.m-gift-level .m-form-item input[type="radio"]',giftOptionSelector:".a-gift-option-select",giftLabel:'.m-gift-level .m-form-item input[type="radio"] + label',swagEligibilityText:".m-membership-gift-selector .swag-eligibility",swagSelector:'.m-select-swag input[type="radio"]',swagLabels:'.m-select-swag input[type="radio"] + label',minAmounts:".m-membership-gift-selector .min-amount",declineGiftLevel:".m-decline-level"};function n(e,t){this.element=e,this.options=o.extend({},h,t),this._defaults=h,this._name=u,this.init()}n.prototype={init(){const e=o(this.element).find(this.options.frequencySelector);o(this.element);const t=o(this.options.amountSelector),n=o(this.element).find(this.options.amountField),i=o(this.element).find(this.options.declineBenefits),s=o(this.element).find(this.options.giftSelector);if(0<n.length&&0<e.length&&0<t.length&&(this.setAmountLabels(e.filter(":checked").val()),this.setMinAmounts(e.filter(":checked").val()),this.checkAndSetLevel(!1),e.on("change",this.onFrequencyChange.bind(this)),t.on("change",this.onSuggestedAmountChange.bind(this)),n.on("keyup mouseup",this.onAmountChange.bind(this)),0<i.length&&0<s.length)){s.not(this.options.declineGiftLevel).is(":checked")&&o(this.element).find(this.options.declineGiftLevel).prop("checked",!1),this.onDeclineBenefitsChange(),this.giftOptionSelect(),this.setRequiredFields(s),i.on("change",this.onDeclineBenefitsChange.bind(this)),s.on("click",this.onGiftsClick.bind(this));const l=r.querySelector(".m-form-membership"),a=r.querySelector(".a-pay-url");a.addEventListener("click",function(e){l.submit(),e.preventDefault()}),r.querySelectorAll(".m-form-membership").forEach(e=>e.addEventListener("submit",e=>{this.onFormSubmit(e)}))}},analyticsProductAction(e,t,n,i,s){e=this.analyticsProduct(e,t,n);wp.hooks.doAction("minnpostMembershipAnalyticsEcommerceAction","event",i,e,s)},analyticsProduct(e,t,n){return{id:"minnpost_"+e.toLowerCase()+"_membership",name:"MinnPost "+e.charAt(0).toUpperCase()+e.slice(1)+" Membership",category:"Donation",brand:"MinnPost",variant:n,price:t,quantity:1}},onFrequencyChange(e){this.setAmountLabels(o(e.target).val()),this.setMinAmounts(o(e.target).val()),this.checkAndSetLevel(!0)},onSuggestedAmountChange(e){o(this.element).find(this.options.amountField).val(null),this.checkAndSetLevel(!0)},onAmountChange(e){this.clearAmountSelector(e);const t=o(e.target);t.data("last-value")!=t.val()&&(t.data("last-value",t.val()),this.checkAndSetLevel(!0))},onDeclineBenefitsChange(e){const t=o(this.element).find(this.options.giftSelectionGroup);"true"===o(this.element).find(this.options.declineBenefits).filter(":checked").val()?t.hide():t.show()},giftOptionSelect(){const e=o(this.options.giftOptionSelector).parent().parent().find('input[type="radio"]');o(this.options.giftOptionSelector).change(function(){""!==o(this).children("option:selected").val()&&e.prop("checked",!0)})},onGiftsClick(e){const t=o(this.element).find(this.options.giftSelector).not(this.options.declineGiftLevel),n=o(this.element).find(this.options.declineGiftLevel);o(e.target).is(this.options.declineGiftLevel)?t.prop("checked",!1):(this.setRequiredFields(t),n.prop("checked",!1))},setRequiredFields(e){const t=e.filter(":checked");t&&(o("[data-required='true']").prop("required",!1),t.each(function(){o("[data-required='true']",o(this).parent()).each(function(){o(this).prop("required",!0)})}))},onFormSubmit(e){let t=o(this.options.amountSelector).filter(":checked").val();void 0===t&&(t=o(this.options.amountField).val());const n=o(this.options.frequencySelector+":checked").val();var i=n.split(" - ")[1],s=n.split(" - ")[0],l=o(this.options.frequencySelector+":checked").prop("id"),l=o('label[for="'+l+'"]').text(),i=a.checkLevel(t,i,s),s={type:"event",category:"Support Us",action:"Become A Member",label:location.pathname},s=(wp.hooks.doAction("minnpostMembershipAnalyticsEvent",s.type,s.category,s.action,s.label),e.target.classList.contains("m-form-membership-support"));s&&(e=this.analyticsProduct(i.name,t,l),wp.hooks.doAction("minnpostMembershipAnalyticsEcommerceAction","event","add_to_cart",e),wp.hooks.doAction("minnpostMembershipAnalyticsEcommerceAction","event","begin_checkout",e))},clearAmountSelector(e){const t=o(this.options.amountSelector);""!==o(e.target).val()&&t.prop("checked",!1)},setAmountLabels(e){const t=o(this.options.amountGroup),n=o(this.options.amountSelector).filter(":checked");var i=n.data("index");const s=o(this.options.customAmountFrequency);t.removeClass("active"),t.filter('[data-frequency="'+e+'"]').addClass("active"),n.prop("checked",!1),t.filter(".active").find('input[type="radio"][data-index="'+i+'"]').prop("checked",!0);e=t.filter(".active").find(".a-frequency-text-label").first().text();s.text(e)},setMinAmounts(e){const t=o(this.options.minAmounts);t.removeClass("active"),t.filter('[data-frequency="'+e+'"]').addClass("active")},checkAndSetLevel(e){let t=o(this.options.amountSelector).filter(":checked").val();void 0===t&&(t=o(this.options.amountField).val());const n=o(this.options.frequencySelector+":checked").val();var i=n.split(" - ")[1],s=n.split(" - ")[0],l=o(this.options.frequencySelector+":checked").prop("id"),l=o('label[for="'+l+'"]').text(),i=a.checkLevel(t,i,s);this.showNewLevel(this.element,this.options,i),this.setEnabledGifts(i),this.analyticsProductAction(i.name,t,l,"select_content",1)},showNewLevel(e,t,n){let i="";let s=t.levelViewer;function l(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})}"undefined"!=typeof minnpost_membership_data&&(i=minnpost_membership_data.member_level_prefix),0<o(t.levelViewer).length&&(o(t.levelViewer).prop("class","a-show-level a-show-level-"+n.name.toLowerCase()),0<o(t.userCurrentLevel).length&&0<minnpost_membership_data.current_user.member_level.length&&(0<o(t.levelViewer).length&&(s=t.levelViewer+" a"),minnpost_membership_data.current_user.member_level.replace(i,"")!==n.name.toLowerCase()?o(s).html(l(o(t.levelViewer).data("changed"))):o(s).html(l(o(t.levelViewer).data("not-changed")))),o(t.levelName,t.levelViewer).text(n.name))},setEnabledGifts(e){o(this.options.giftSelector).each(function(){o(this).prop("disabled",e.yearlyAmount<o(this).data("minYearlyAmount"))}),o(this.options.swagSelector).not("#swag-decline").is(":enabled")?(o(".swag-disabled").removeClass("active"),o(".swag-enabled").addClass("active")):(o(".swag-disabled").addClass("active"),o(".swag-enabled").removeClass("active"))}},o.fn[u]=function(e){return this.each(function(){o.data(this,"plugin_"+u)||o.data(this,"plugin_"+u,new n(this,e))})}}(l=jQuery)(document).ready(function(){0<l(".m-form-membership-benefit").length&&(2===performance.navigation.type&&location.reload(!0),l(".a-benefit-button.a-button-disabled").removeAttr("disabled"),l(".a-benefit-button").click(function(e){e.preventDefault();const n=l(this),i=l(".m-benefit-message",l(this).parent()),s=l("select",l(this).parent());var t,e=minnpost_membership_settings;n.text("Processing").addClass("a-button-disabled"),l(".a-benefit-button").addClass("a-button-disabled");"partner-offers"===l('input[name="benefit-name"]').val()&&(t={action:"benefit_form_submit",minnpost_membership_benefit_form_nonce:n.data("benefit-nonce"),current_url:l('input[name="current_url"]').val(),"benefit-name":l('input[name="benefit-name"]').val(),instance_id:l('[name="instance-id-'+n.val()+'"]').val(),post_id:n.val(),is_ajax:"1"},l.post(e.ajaxurl,t,function(t){!0===t.success?(n.val(t.data.button_value).text(t.data.button_label).removeClass("a-button-disabled").addClass(t.data.button_class).prop(t.data.button_attr,!0),i.html(t.data.message).addClass("m-benefit-message-visible "+t.data.message_class),0<s.length&&s.prop("disabled",!0),l(".a-benefit-button").not(n).val(t.data.button_value).attr("disabled",!0)):(void 0!==t.data.remove_instance_value&&l("option",s).each(function(e){l(this).val()===t.data.remove_instance_value&&l(this).remove()}),""!==t.data.button_label?(n.show(),n.val(t.data.button_value).text(t.data.button_label).removeClass("a-button-disabled").addClass(t.data.button_class).prop(t.data.button_attr,!0)):n.hide(),l(".a-benefit-button").not(n).removeClass("a-button-disabled"),i.html(t.data.message).addClass("m-benefit-message-visible "+t.data.message_class))}))})),l(".a-refresh-page").on("click",function(e){e.preventDefault(),location.reload()})});const s=document.querySelector(".m-support-cta-top .a-support-button");s&&s.addEventListener("click",function(e){let t="";const n=s.querySelector("svg");var i;null!==n&&null!==(i=n.getAttribute("title"))&&(t=i+" "),t+=s.textContent,wp.hooks.doAction("minnpostMembershipAnalyticsEvent","event","Support CTA - Header","Click: "+t,location.pathname)});{var m=jQuery,c=(window,document,MinnPostMembership);const d="minnpostMembership",p={debug:!1,amount_viewer:".amount h3",frequency_selector_in_levels:".a-form-item-membership-frequency",frequency_selector_in_levels_type:"select",levels_container:".o-membership-member-levels",single_level_container:".m-membership-member-level",single_level_summary_selector:".m-member-level-brief",flipped_items:"div.amount, div.enter",level_frequency_text_selector:".show-frequency",choose_amount_selector_in_levels:".amount .a-button-flip",amount_selector_in_levels:".enter input.amount-entry"};function i(e,t){this.element=e,this.options=m.extend({},p,t),this._defaults=p,this._name=d,this.init()}i.prototype={init(e,t){this.catchHashLinks(this.element,this.options),this.levelFlipper(this.element,this.options),this.startLevelClick(this.element,this.options)},catchHashLinks(e,t){m('a[href*="#"]:not([href="#"])',e).click(function(e){e=m(e.target);if(0==e.parent(".comment-title").length&&location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname&&(e=(e=m(this.hash)).length?e:m("[name="+this.hash.slice(1)+"]")).length)return m("html,body").animate({scrollTop:e.offset().top},1e3),!1})},levelFlipper(t,n){const i=this;let s=0,l="",a=0,o="",r="",c="";0<m(n.levels_container).length&&(m(n.single_level_summary_selector,t).each(function(){m(n.flipped_items,m(this)).wrapAll('<div class="flipper"/>')}),m(n.frequency_selector_in_levels,t).on("change",function(e){a=m(this).data("member-level-number"),o=m(this).val(),r=o.split(" - ")[1],c=o.split(" - ")[0],void 0!==a?(m(n.single_level_summary_selector,t).removeClass("flipped"),m(n.single_level_container,t).removeClass("active"),m(e.target).closest(n.single_level_summary_selector).addClass("flipped"),1==r?m(n.amount_selector_in_levels,m(n.single_level_container+"-"+a)).val(m(n.amount_viewer,m(n.single_level_container+"-"+a)).data("default-yearly")):12==r&&m(n.amount_selector_in_levels,m(n.single_level_container+"-"+a)).val(m(n.amount_viewer,m(n.single_level_container+"-"+a)).data("default-monthly")),s=m(n.amount_selector_in_levels+'[data-member-level-number="'+a+'"]').val(),l=i.checkLevel(s,r,c,t,n),i.changeFrequency(o,l.name,t,n)):0<m(n.level_frequency_text_selector).length&&(m(n.level_frequency_text_selector,t).text(c),m(n.single_level_container).each(function(){void 0!==(a=m(n.amount_selector_in_levels,m(this)).data("member-level-number"))&&(s=m(n.amount_selector_in_levels,m(this)).val(),l=i.checkLevel(s,r,c,t,n))})),i.changeAmountPreview(o,l.name,t,n)})),0<m(n.choose_amount_selector_in_levels).length&&m(n.choose_amount_selector_in_levels,t).click(function(e){a=m(n.frequency_selector_in_levels,t).data("member-level-number"),m(n.single_level_summary_selector,t).removeClass("flipped"),m(n.single_level_container,t).removeClass("active"),m(e.target).closest(n.single_level_summary_selector).addClass("flipped"),o=m(n.frequency_selector_in_levels,m(this).parent()).val(),r=o.split(" - ")[1],s=m(n.amount_selector_in_levels+'[data-member-level-number="'+a+'"]').val(),l=i.checkLevel(s,r,c,t,n),e.preventDefault()})},checkLevel(e,t,n,i,s){const l=c.checkLevel(e,t,n);return m("h2",s.single_level_summary_selector).each(function(){m(this).text()==l.name&&(m(s.single_level_container,i).removeClass("active"),m(this).parent().parent().addClass("active"))}),l},changeFrequency(a,e,t,o){m(o.single_level_summary_selector).each(function(){let e=m(o.amount_viewer,m(this)).text();var t=m(o.amount_viewer,m(this)).data("month"),n=m(o.amount_viewer,m(this)).data("year"),i=m(o.amount_viewer,m(this)).data("one-time"),s=a.split(" - ")[0],l=parseInt(a.split(" - ")[1]);m(o.frequency_selector_in_levels).val(a),m(o.frequency_selector_in_levels).prop("selected",a),"per month"==s?(e=t,m(o.amount_viewer,m(this)).removeClass("smaller")):"per year"==s?(e=n,m(o.amount_viewer,m(this)).addClass("smaller")):"one-time"==s&&(e=i,m(o.amount_viewer,m(this)).addClass("smaller")),m(o.amount_viewer,m(this)).text(e),m(o.frequency_selector_in_levels,m(this)).data("frequency",l)})},changeAmountPreview(l,e,t,a){m(a.single_level_summary_selector).each(function(){let e=m(a.amount_viewer,m(this)).text();var t=m(a.amount_viewer,m(this)).data("month"),n=m(a.amount_viewer,m(this)).data("year"),i=m(a.amount_viewer,m(this)).data("one-time"),s=l.split(" - ")[0];"per month"==s?(e=t,m(a.amount_viewer,m(this)).removeClass("smaller")):"per year"==s?(e=n,m(a.amount_viewer,m(this)).addClass("smaller")):"one-time"==s&&(e=i,m(a.amount_viewer,m(this)).addClass("smaller")),m(a.amount_viewer,m(this)).text(e)})},startLevelClick(t,n){m(".start-level").click(function(){var e=m(this).prop("class"),e=e[e.length-1];m(n.single_level_summary_selector,t).removeClass("flipped"),m(n.single_level_container,t).removeClass("active"),m(n.single_level_container+"-"+e,t).addClass("active"),m(n.single_level_container+"-"+e+" "+n.single_level_summary_selector).addClass("flipped")})}},m.fn[d]=function(e){return this.each(function(){m.data(this,"plugin_"+d)||m.data(this,"plugin_"+d,new i(this,e))})}}}(jQuery);