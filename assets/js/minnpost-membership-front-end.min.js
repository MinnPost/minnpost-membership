"use strict";!function($,window,document,undefined){var pluginName="minnpost_membership",defaults={debug:!1,amount_selector_standalone:"#amount-item #amount",frequency_selector_standalone:'.m-membership-fast-select input[type="radio"]',amount_viewer:".amount h3",frequency_selector_in_levels:".a-form-item-membership-frequency",frequency_selector_in_levels_type:"select",levels_container:".o-membership-member-levels",single_level_container:".m-membership-member-level",single_level_summary_selector:".m-member-level-brief",flipped_items:"div.amount, div.enter",level_frequency_text_selector:".show-frequency",choose_amount_selector_in_levels:".amount .a-button-flip",amount_selector_in_levels:".enter input.amount-entry"};function Plugin(element,options){this.element=element,this.options=$.extend({},defaults,options),this._defaults=defaults,this._name=pluginName,this.init()}Plugin.prototype={init:function(reset,amount){this.catchHashLinks(this.element,this.options),this.levelFlipper(this.element,this.options),this.startLevelClick(this.element,this.options)},catchHashLinks:function(element,options){$('a[href*="#"]:not([href="#"])',element).click(function(e){var target;if(0==(target=$(e.target)).parent(".comment-title").length&&location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname&&(target=(target=$(this.hash)).length?target:$("[name="+this.hash.slice(1)+"]")).length)return $("html,body").animate({scrollTop:target.offset().top},1e3),!1})},levelFlipper:function(element,options){var that=this,previous_amount="",amount=0,level="",level_number=0,frequency_string="",frequency="",frequency_name="";"undefined"!=typeof minnpost_membership_data&&(previous_amount=minnpost_membership_data.current_user.previous_amount),0<$(options.amount_selector_standalone).length&&(amount=$(options.amount_selector_standalone).val(),frequency_string=$(options.frequency_selector_standalone+":checked").val(),frequency=frequency_string.split(" - ")[1],frequency_name=frequency_string.split(" - ")[0],console.log("there is an amount field. value is "+amount),level=that.checkLevel(amount,frequency,frequency_string,previous_amount,element,options),console.log("initial level is "+level),$(options.frequency_selector_standalone).change(function(){level=that.checkLevel($(options.amount_selector_standalone).val(),$(options.frequency_selector_standalone+":checked").attr("data-year-frequency"),$(options.frequency_selector_standalone+":checked").val(),previous_amount,element,options),console.log("input radio change level is "+level)}),$(options.amount_selector_standalone).bind("keyup mouseup",function(){$(this).data("last-value")!=$(this).val()&&($(this).data("last-value",$(this).val()),level=that.checkLevel($(options.amount_selector_standalone).val(),$(options.frequency_selector_standalone+":checked").attr("data-year-frequency"),$(options.frequency_selector_standalone+":checked").val(),previous_amount,element,options),console.log("input text change level is "+level))})),0<$(options.levels_container).length&&($(options.single_level_summary_selector,element).each(function(){$(options.flipped_items,$(this)).wrapAll('<div class="flipper"/>')}),$(options.frequency_selector_in_levels,element).on("focusout change",function(event){level_number=$(this).data("member-level-number"),frequency_string=$(this).val(),frequency=frequency_string.split(" - ")[1],frequency_name=frequency_string.split(" - ")[0],void 0!==level_number?(amount=$(options.amount_selector_in_levels+'[data-member-level-number="'+level_number+'"]').val(),$(options.single_level_summary_selector,element).removeClass("flipped"),$(options.single_level_container,element).removeClass("active"),$(event.target).closest(options.single_level_summary_selector).addClass("flipped"),level=that.checkLevel(amount,frequency,frequency_string,previous_amount,element,options),that.changeFrequency(frequency_string,level,element,options),1==frequency?$(options.amount_selector_in_levels).val($(options.amount_viewer,$(options.single_level_container+"-"+level_number)).data("default-yearly")):12==frequency&&$(options.amount_selector_in_levels).val($(options.amount_viewer,$(options.single_level_container+"-"+level_number)).data("default-monthly"))):0<$(options.level_frequency_text_selector).length&&($(options.level_frequency_text_selector,element).text(frequency_name),$(options.single_level_container).each(function(){void 0!==(level_number=$(options.amount_selector_in_levels,$(this)).data("member-level-number"))&&(amount=$(options.amount_selector_in_levels,$(this)).val(),level=that.checkLevel(amount,frequency,frequency_string,previous_amount,element,options))})),that.changeAmountPreview(frequency_string,level,element,options)})),0<$(options.choose_amount_selector_in_levels).length&&$(options.choose_amount_selector_in_levels,element).click(function(event){level_number=$(options.frequency_selector_in_levels,element).data("member-level-number"),$(options.single_level_summary_selector,element).removeClass("flipped"),$(options.single_level_container,element).removeClass("active"),$(event.target).closest(options.single_level_summary_selector).addClass("flipped"),frequency_string=$(options.frequency_selector_in_levels,$(this).parent()).val(),frequency=frequency_string.split(" - ")[1],amount=$(options.amount_selector_in_levels+'[data-member-level-number="'+level_number+'"]').val(),level=that.checkLevel(amount,frequency,frequency_string,previous_amount,element,options),event.preventDefault()})},checkLevel:function(amount,frequency,type,previous_amount,element,options){var thisyear=amount*frequency,level="",level_number="";if(void 0!==previous_amount&&""!==previous_amount){var prior_year_amount=previous_amount.prior_year_amount,coming_year_amount=previous_amount.coming_year_amount,annual_recurring_amount=previous_amount.annual_recurring_amount;"one-time"===type?prior_year_amount+=thisyear:annual_recurring_amount+=thisyear,thisyear=Math.max(prior_year_amount,coming_year_amount,annual_recurring_amount)}return 0<thisyear&&thisyear<60?(level="Bronze",level_number=1):59<thisyear&&thisyear<120?(level="Silver",level_number=2):119<thisyear&&thisyear<240?(level="Gold",level_number=3):239<thisyear&&(level="Platinum",level_number=4),$(".fast-select .level").text(level),$(".fast-select .show-level").attr("class","show-level "+level_number),0<$(".current-level").length&&($(".current-level").text().replace(/(<([^>]+)>)/gi,"")!=$(".new-level").text().replace(/(<([^>]+)>)/gi,"")?($(".show-level .change").show(),$(".show-level .nochange").hide()):($(".show-level .change").hide(),$(".show-level .nochange").show())),$("h2",options.single_level_summary_selector).each(function(){$(this).text()==level&&$(options.single_level_container,element).removeClass("active")}),level.toLowerCase()},changeFrequency:function(selected,level,element,options){$(options.single_level_summary_selector).each(function(){var range=$(options.amount_viewer,$(this)).text(),month_value=$(options.amount_viewer,$(this)).data("month"),year_value=$(options.amount_viewer,$(this)).data("year"),once_value=$(options.amount_viewer,$(this)).data("one-time"),frequency_name=selected.split(" - ")[0],frequency=parseInt(selected.split(" - ")[1]);$(options.frequency_selector_in_levels).val(selected),$(options.frequency_selector_in_levels).prop("selected",selected),"per month"==frequency_name?(range=month_value,$(options.amount_viewer,$(this)).removeClass("smaller")):"per year"==frequency_name?(range=year_value,$(options.amount_viewer,$(this)).addClass("smaller")):"one-time"==frequency_name&&(range=once_value,$(options.amount_viewer,$(this)).addClass("smaller")),$(options.amount_viewer,$(this)).text(range),$(options.frequency_selector_in_levels,$(this)).data("frequency",frequency)})},changeAmountPreview:function(selected,level,element,options){$(options.single_level_summary_selector).each(function(){var range=$(options.amount_viewer,$(this)).text(),month_value=$(options.amount_viewer,$(this)).data("month"),year_value=$(options.amount_viewer,$(this)).data("year"),once_value=$(options.amount_viewer,$(this)).data("one-time"),frequency_name=selected.split(" - ")[0];"per month"==frequency_name?(range=month_value,$(options.amount_viewer,$(this)).removeClass("smaller")):"per year"==frequency_name?(range=year_value,$(options.amount_viewer,$(this)).addClass("smaller")):"one-time"==frequency_name&&(range=once_value,$(options.amount_viewer,$(this)).addClass("smaller")),$(options.amount_viewer,$(this)).text(range)})},startLevelClick:function(element,options){$(".start-level").click(function(){var level_class=$(this).prop("class"),level_number=level_class[level_class.length-1];$(options.single_level_summary_selector,element).removeClass("flipped"),$(options.single_level_container,element).removeClass("active"),$(options.single_level_container+"-"+level_number,element).addClass("active"),$(options.single_level_container+"-"+level_number+" "+options.single_level_summary_selector).addClass("flipped")})}},$.fn[pluginName]=function(options){return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,options))})}}(jQuery,window,document);